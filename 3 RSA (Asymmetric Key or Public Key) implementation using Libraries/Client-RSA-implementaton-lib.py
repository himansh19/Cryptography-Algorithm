import socket
import rsa

# IP = socket.gethostbyname(socket.gethostname())
IP='192.168.43.64'
PORT = 8085
ADDR = (IP, PORT)
SIZE = 1024
FORMAT = "utf-8"
DISCONNECT_MSG = "!DISCONNECT"

def main():
    client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    client.connect(ADDR)
    print(f"[CONNECTED] Client connected to server at {IP}:{PORT}")

    privateKey = rsa.key.PrivateKey(9412330705965798665703097813066132790768966303411944846590440880658861990524651348476803393127126249346611522575737397964449653428653292192160655383534563, 65537, 1978776759186364557670587327287260289473348150333548622859195484287010397583022150398052897478709232726680594781259012210474055994962672763097060679221745, 5737416430982229463246760768373345836184687274223380874988492863737854956859066197, 1640517264031754145132906698135906279697097359675327456696787040828565079)

    server_public_key = rsa.key.PublicKey(8406422488038002834466942761566961071670485821351708215994036290962078623891582923624499222758629182472408657133426472724325163911173134187091483147187109, 65537)

    connected = True
    while connected:
        data = input("> ")

        data1 = rsa.encrypt(data.encode(FORMAT), server_public_key)

        client.send(data1)

        if data == DISCONNECT_MSG:
            connected = False
        else:
            msg = client.recv(SIZE)
            msg1 = rsa.decrypt(msg, privateKey).decode(FORMAT)
            print(msg)
            print(f"[SERVER] {msg1}")

main()